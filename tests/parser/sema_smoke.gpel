// sema_smoke.gpel

@comptime @pure export fn scale_add(a: int, b: int, { scale: int = 2, bias: int = 0 }) -> int {
  // (a + b) * scale + bias
  set s = (a + b) * scale;
  return s + bias;
}

@inline @no_mangle fn id_u32(x: u32) -> u32 {
  return x;
}

export fn entry() -> void {
  set a = 3;
  set b = 4;

  // named-group 기본값 적용 (scale=2, bias=0)
  set r0 = scale_add(a, b, { });

  // named-group 부분 지정
  set r1 = scale_add(a, b, { scale: 10 });

  // hole 허용 정책을 쓴다면(“값 미정/나중 지정”), timeout_ms 같은 곳에 적용
  rpcCall({ endpoint: "login", retry: 3, timeout_ms: _ });

  // 타입 체크: u32로만 받아야 함
  set u = id_u32(1);

  // 블록 스코프/if
  if (r1 > r0) {
    set diff = r1 - r0;
    // diff는 int
  }
}

export fn find42(xs: int[]) -> int? {
  set found = loop (v in xs) {
    if (v == 42) { break v; }
  };
  return found;
}

fn sum_to(n: int) -> int {
  // 아직 mut 키워드 파싱 못함
  set mut s = 0;
  loop (i in 0..:n) {
    s = s + i;
  };
  return s;
}

fn make_value() -> int {
  set x = loop {
    break 7;
  };
  return x;
}

// 이건 오류이지만(while안에서는 break;만 가능) 파서 단계에서 잡지 않음
fn add() -> int {
  while (1) {
    break 42;
  }

  switch (1) {
    case 1 : {}
    case 2 : {}
  }
}
